var BFGutenbergAPI=function(){var e={},t={},r={},i="",n={className:{removeAll:function(e,t){var r=this.remove;return t.forEach(function(t){e=r(e,t)}),e},remove:function(e,t){return e?e.replace(new RegExp("\\b"+t+"\\b","g"),"").trim():""},add:function(e,t){if(!e)return t;var r=e.split(" ");return r.push(t),_.unique(r).join(" ")}}};function o(r){this.element=window.wp&&window.wp.element,this.blocks=window.wp&&window.wp.blocks,this.prefix="better-studio/",this.props={},this.attributes={},this.blockFields={},this.shortcode={},this.props=r,this.attributes=r&&r.attributes||{},r&&r.clientId&&r.attributes&&(e[r.clientId]=r.attributes,t[r.clientId]=r,r.isSelected&&(i=r.clientId))}return o.prototype.overrideBlock=function(e){this.overrideSettings=e||{}},o.prototype.registerBlockType=function(e,t){this.shortcode=e,this.blockFields=t;var r=this.shortcode.block_id||this.shortcode.id.replace(/_/g,"-"),i=this.shortcode.category||"betterstudio";this.bfGutenbergCatExists(i)&&this.blocks.registerBlockType(this.prefix+r,_.extend({title:this.shortcode.name||this.shortcode.id,icon:this.blockIcon(),category:i,save:this.saveBlock.bind(this),attributes:this.blockAttributes(this.shortcode.id),example:{preview:!0}},this.overrideSettings,{edit:this.editBlock.bind(this)}))},o.prototype.saveBlock=function(e){return null},o.prototype.bfGutenbergCatExists=function(e){if(void 0===r[e]){r[e]=!1;for(var t=this.blocks.getCategories()||[],i=0;i<t.length;i++)if(t[i].slug===e){r[e]=!0;break}}return r[e]},o.prototype.blockAttributes=function(e){if(!this.blockFields)return[];var t={},r=function(e){e.id&&e.attribute&&(t[e.id]=e.attribute),e.children&&e.children.forEach(function(e){r(e)})};return this.blockFields.forEach(r),this.overrideSettings.filterAttributes&&(t=this.overrideSettings.filterAttributes(t)),t},o.prototype.editBlock=function(e){var t=e.name.replace(this.prefix,"");if(!t||t===e.name)return[];(e.isSelected||void 0===this.props)&&(this.props=e);var r=[];if((void 0===this.overrideSettings.defaultAttributes||this.overrideSettings.defaultAttributes)&&r.push(this.buildBlockFields()),"function"==typeof this.overrideSettings.edit)return r.push(this.overrideSettings.edit(e)),r;var i=!this.shortcode.click_able,n=this.element.createElement(this.getComponent("ServerSideRender"),{block:e.name,attributes:e.attributes,key:"D2"});return i&&(n=this.element.createElement(this.getComponent("Disabled"),{key:"D1"},n)),r.push(n),r},o.prototype.buildElement=function(e,t){var r=[],i=this;return e.forEach(function(e){e.children?r.push(i.buildElement(e.children,e)):Array.isArray(e)?r.push(i.buildElement(e,t)):r.push(i.createElement(e))}),i.createElement(t,r)},o.prototype.createElement=function(e,t){var r=[];t&&t.length?r=t:e.args&&e.args.innerText&&(r=e.args.innerText);var i=[this.getComponent(e.component),this.componentArgs(e)].concat(r);return this.element.createElement.apply(this.element,i)},o.prototype.componentArgs=function(t){var r=t.args||{};if("Fragment"===t.component||t.component.match(/tag_(.+)/))return r;var i=this,o="add_class"===t.action;r.onChange=r.onChange||function(r){var s,c;if(o){var a=i.props.attributes.className;if(t.attribute&&t.attribute.enum)c=n.className.removeAll(a,t.attribute.enum),c=n.className.add(c,r);else if(0===r||1===r){var l=t.id;c=n.className[1===r?"add":"remove"](a,l)}s="className"}else s=t.id,c=r;s&&i.props.setAttributes({[s]:c});var u=i.props.clientId;return u&&e[u]&&e[u][s]&&(e[u][s]=c),!1};var s="";return o?t.attribute&&this.props.attributes.className&&(s=_.intersection(t.attribute.enum||[t.id],this.props.attributes.className.split(" ")).shift()):s=this.props.attributes[t.id],r.value=s||t.std,-1===["block_fragment","inspector","edit-panel"].indexOf(r.key)&&void 0===r.value&&(r.value=""),r},o.prototype.buildBlockFields=function(){var e=[{id:"inspector",component:"InspectorControls",args:{key:"inspector"},children:[{id:"bf_edit_panel",component:"BF_Edit_Panel",args:{type:"edit-panel"},key:"bf_edit_panel",children:this.blockFields}]}];return this.buildElement(e,{id:"block_fragment",component:"Fragment",args:{key:"block_fragment"}})},o.prototype.getComponent=function(e){var t=e.match(/tag_(.+)/);return t?t[1]:wp.editor[e]?wp.editor[e]:wp.components[e]?wp.components[e]:wp.element[e]?wp.element[e]:void 0},o.prototype.blockIcon=function(){if(this.shortcode.icon_url)return this.element.createElement("img",{src:this.shortcode.icon_url});var e="tabs"==this.shortcode.id?{icon:"admin-page"}:"align-center";return this.shortcode.icon||e.icon},{init:function(){wp.hooks&&wp.hooks.addFilter&&wp.compose&&wp.compose.createHigherOrderComponent&&(this.registerBlocks(),BF_Gutenberg.stickyFields&&(this.registerSharedFields(),this.registerSharedAttributes()))},registerBlocks:function(){var e;if(BF_Gutenberg&&BF_Gutenberg.blocks)for(var t in BF_Gutenberg.blocks)(e=new o).overrideBlock("object"==typeof BF_Gutenebrg_Export&&BF_Gutenebrg_Export[t]),e.registerBlockType(BF_Gutenberg.blocks[t],BF_Gutenberg.blockFields[t])},extraAttributes:function(e){var t=BF_Gutenberg.extraAttributes,r={};for(var i in t)if(t.hasOwnProperty(i)){var n=t[i];(n.for_blocks||[]).indexOf(e)>-1&&(r[i]=n)}return r},registerSharedAttributes:function(){var e=this;wp.hooks.addFilter("blocks.registerBlockType","betterstudio/shared_settings",function(t,r){var i=e.extraAttributes(r);return _.isEmpty(i)||(t.attributes=_.extend(t.attributes,i)),t})},registerSharedFields:function(){wp.hooks.addFilter("editor.BlockEdit","betterstudio/shared_settings",wp.compose.createHigherOrderComponent(function(e){return function(t){var r=new o(t),i=BF_Gutenberg.stickyFields.filter(function(e){return!(e.exclude_blocks&&e.exclude_blocks.indexOf(t.name)>-1)&&(!e.include_blocks||e.include_blocks.indexOf(t.name)>-1)});if(!i)return r.element.createElement(e,t);var n=r.buildElement(i,{id:"inspector",component:"InspectorControls",args:{key:"inspector"}});return r.element.createElement(r.getComponent("Fragment"),{key:"E1"},n,r.element.createElement(e,t))}}))}}.init(),{activeBlock:function(){return i},blockValues:function(t){if((t=t||this.activeBlock())&&e[t])return JSON.parse(JSON.stringify(e[t]))},blockInstance:function(e){if((e=e||this.activeBlock())&&t[e])return t[e]}}}();