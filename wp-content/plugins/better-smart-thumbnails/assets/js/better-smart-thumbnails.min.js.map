{"version":3,"sources":[".before-concat.txt","utils.js","preview-data.js","preview-modal.js","focus-point.js","media-modal.js","media-lib-page.js"],"names":["jQuery","document","ready","$","helper","isObject","obj","type","isUndefined","notify","$el","message","append","fadeIn","delay","queue","n","this","fadeOut","remove","defaultFocusPoint","imageWidth","imageHeight","loc","get","isImagePortrait","cache","storage","add","name","data","group","exist","UI","is_blocked","$element","block","prepend","unblock","indexOf","st_loc","_v","split","current","splice","len","length","i","translate","index","previewData","attachmentId","securityNonce","Deferred","deferred","resolveWith","ajax","wp","post","thumbnail_id","nonce","done","res","fail","rejectWith","promise","previewModal","info","setup","open","self","images","bs_selector_modal","bsModal","destroyHtml","show","noSidebar","id","modalClass","itemInnerHtml","content","l10n","items","map","noCacheImage","itemsGroupSize","events","initialZIndex","img","Date","getTime","focusPoint","markerArea","isMouseDown","$container","options","prepare","bindEvents","wrap","parent","defaultPosition","fixMarkerPosition","grid","appendGrid","handle_event","event","args","Array","prototype","slice","call","arguments","apply","$grid","class","insertAfter","find","html","pos","x","parseFloat","y","$img","css","top","Math","floor","height","left","width","$marker","$markerWrapper","$m","parentSelector","closest","mousedown","e","trigger","pageX","pageY","mouseup","parseInt","replace","topPercent","ceil","leftPercent","min","offset","on","box","max","mediaModal","initialized","$context","media","featuredImage","frame","initFeaturedImageModal","frames","isUploadPage","one","setTimeout","initMediaLibraryModal","initFocusPoint","appendPreviewButton","models","Uploader","appendPreviewLink","a","interval","setInterval","clearInterval","edit","getFocusPoint","proxy","saveFocusPoint","link","$link","preventDefault","$afterEl","loading","always","regenerateThumbnails","setFocusPoint","attachment_id","focus_x","focus_y","$msgParent","state","body","hasClass","val","$attachment","point","getDefaultFocusPoint","mediaLibPage","$body","editAttachmentPage"],"mappings":"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","file":"better-smart-thumbnails.min.js","sourcesContent":["jQuery(document).ready(function($) {","var helper = {\n    isObject: function (obj) {\n        var type = typeof obj;\n        return type === 'function' || type === 'object' && !!obj;\n    },\n    isUndefined: function (obj) {\n\n        return obj === void 0;\n    },\n\n    notify: function ($el, message) {\n\n        $el.append(\"<div class='bt-user-message success' style='display: none;'>\" + message + \"</div>\");\n\n        $(\".bt-user-message\", $el).fadeIn().delay(5e3).queue(function (n) {\n\n            $(this).fadeOut(function () {\n                $(this).remove();\n            });\n            n();\n        });\n    },\n\n    defaultFocusPoint: function (imageWidth, imageHeight) {\n\n        if (loc.get('portrait_default_top') &&\n            this.isImagePortrait(imageWidth, imageHeight)) {\n\n            return [0.5, 0];\n        }\n\n        return loc.get('default_fp');\n    },\n\n    isImagePortrait: function (imageWidth, imageHeight) {\n\n        return ( imageWidth + ( imageHeight * 0.14 ) ) < imageHeight;\n    }\n};\nvar cache = {\n    storage: {},\n\n    add: function (name, data, group) {\n\n        if (helper.isUndefined(cache[group]))\n            cache[group] = {};\n\n        cache[group][name] = data;\n    },\n\n    get: function (name, group) {\n\n        if (this.exist(name, group)) {\n\n            return cache[group][name];\n        }\n    },\n\n    exist: function (name, group) {\n\n        return !helper.isUndefined(cache[group]) && !helper.isUndefined(cache[group][name]);\n    }\n};\n\n\nvar UI = {\n\n    is_blocked: function ($element) {\n\n        return !!$element.data('bc-el-blocked');\n    },\n\n    block: function ($element) {\n\n        if (this.is_blocked($element)) {\n            return;\n        }\n\n        $element.data('bc-el-blocked', true);\n\n        $element.prepend('<div class=\"bc-block-overlay\" style=\"z-index:10;display:none;border:none;margin:0;padding:0;width:100%;height:100%;top:0;left:0;display:none;position: absolute;background:rgba(255,255,255,0.4)\"></div>');\n\n        $(\".bc-block-overlay\").fadeIn();\n    },\n\n\n    unblock: function ($element) {\n\n        if (!this.is_blocked($element)) {\n            return;\n        }\n\n        $element.data('bc-el-blocked', false);\n\n        $(\".bc-block-overlay\").fadeOut(function () {\n            $(this).remove();\n        });\n    },\n};\n\n\nvar loc = {\n\n    get: function (loc) {\n\n        if (!loc) {\n            return;\n        }\n\n        if (loc.indexOf('.') == -1) {\n\n            return st_loc[loc];\n        }\n\n        var _v = loc.split('.');\n        var current = st_loc[_v[0]];\n        _v = _v.splice(1);\n\n        var len = _v.length - 1;\n\n        for (var i = 0; i <= len; i++) {\n\n            if (typeof current[_v[i]] !== 'object' && i !== len) {\n                return;\n            }\n\n            current = current[_v[i]];\n        }\n\n        return current;\n    },\n\n    translate: function (index) {\n\n        return this.get('translate.' + index);\n    }\n};","var previewData = {\n\n    get: function (attachmentId, securityNonce) {\n\n        return $.Deferred(function (deferred) {\n\n            if (cache.exist(attachmentId, 'selector-data')) {\n\n                deferred.resolveWith(this, [cache.get(attachmentId, 'selector-data')]);\n\n                return;\n            }\n\n            var ajax = wp.ajax.post('bt-preview-thumbnails', {\n                thumbnail_id: attachmentId,\n                nonce: securityNonce\n            });\n\n            ajax.done(function (res) {\n                cache.add(attachmentId, res, 'selector-data');\n                deferred.resolveWith(this, [res]);\n            });\n\n            ajax.fail(function () {\n\n                deferred.rejectWith(this);\n            });\n        }).promise();\n    },\n};","var previewModal = {\n\n    info: {},\n\n    setup: function (info) {\n\n        this.info = info;\n\n        this.open();\n    },\n\n    open: function () {\n\n        var self = this;\n\n        if (!self.info.images) {\n            return;\n        }\n\n\n        $.bs_selector_modal({\n            bsModal: {\n                destroyHtml: true,\n                show: true\n            },\n\n            noSidebar: true,\n\n            id: 'bt-thumbnil-selector',\n            modalClass: 'bt-modal',\n\n            itemInnerHtml: '<div class=\"bf-item-container\">\\n    <figure>\\n        <img src=\"{{img}}\"\\n             alt=\"{{label}}\"\\n             class=\"bs-style-thumbnail\" data-current-image=\"{{current_img}}\">\\n    </figure>\\n</div>',\n\n            content: self.info.l10n,\n            items: self.info.images.map(self.noCacheImage),\n\n            itemsGroupSize: 9,\n\n            events: {}\n        }, {\n            initialZIndex: 209901\n        });\n    },\n\n    noCacheImage: function (obj) {\n\n        obj.img += \"?\" + new Date().getTime();\n\n        return obj;\n    }\n};","var focusPoint = {\n\n    markerArea: 10,\n\n    isMouseDown: false,\n    $element: false,\n    $container: false,\n\n    options: {},\n\n    events: {},\n\n    setup: function (options, events) {\n\n        this.events = events || {};\n        this.options = options || {};\n\n        if (this.prepare()) {\n\n            this.bindEvents();\n\n            return true;\n        }\n\n        return false;\n    },\n\n    prepare: function () {\n\n        if (!this.options.$el || !this.options.$el.length) {\n            return false;\n        }\n\n        this.$element = this.options.$el;\n        this.$element.wrap(\"<div class='bt-focus-point'></div>\");\n        //\n        this.$container = this.$element.parent();\n        this.$container.append('<div class=\"bt-focus-point-marker\"></div>');\n\n        if (this.options.defaultPosition) {\n            this.fixMarkerPosition(this.options.defaultPosition);\n        }\n\n        if (this.options.grid) {\n            this.appendGrid();\n        }\n\n        return true;\n    },\n\n    handle_event: function (event) {\n        var args = Array.prototype.slice.call(arguments, 1);\n\n        if (typeof this.events[event] === 'function')\n            return this.events[event].apply(this, args);\n    },\n\n    appendGrid: function () {\n\n        var $grid = $(\"<div>\", {\"class\": \"grid\"}).insertAfter(this.$container.find('img'));\n\n        $grid.html('<div class=\"x1\"></div>\\n<div class=\"x2\"></div>\\n\\n<div class=\"y1\"></div>\\n<div class=\"y2\"></div>');\n    },\n\n    fixMarkerPosition: function (pos) {\n\n        var x = parseFloat(pos[0]),\n            y = parseFloat(pos[1]);\n\n        if (!(x >= 0 && x <= 1)) {\n            return;\n        }\n\n        if (!(y >= 0 && y <= 1)) {\n            return;\n        }\n\n        var $img = this.$container.find('img');\n        var markerArea = this.markerArea;\n\n        $(\".bt-focus-point-marker\", this.$container).css({\n            top: Math.floor($img.height() * y) - markerArea,\n            left: Math.floor($img.width() * x) - markerArea\n        });\n    },\n\n    bindEvents: function () {\n\n        var self = this;\n\n        var markerArea = this.markerArea,\n            $marker = $(\".bt-focus-point-marker\", this.$container);\n\n        var $markerWrapper = (function () {\n\n            var $m = self.options.parentSelector ? $(\".bt-focus-point-marker\", this.$container).closest(self.options.parentSelector) : '';\n\n            if ($m && $m.length) {\n                return $m;\n            }\n\n            return $(\".bt-focus-point-marker\", this.$container);\n\n        })();\n\n        $marker.mousedown(function () {\n\n            self.isMouseDown = true;\n        });\n\n        $(\".bt-focus-point\").mousedown(function (e) {\n\n            self.isMouseDown = true;\n\n            $(document).trigger('mousemove.bt-focus-point', [e.pageX, e.pageY]);\n        });\n\n\n        $markerWrapper.mouseup(function () {\n\n            if (!self.isMouseDown) {\n                return;\n            }\n\n            self.isMouseDown = false;\n\n\n            var top = parseInt($marker.css('top').replace('px', '')),\n                left = parseInt($marker.css('left').replace('px', ''));\n\n            var topPercent = Math.ceil((top + markerArea) / (self.$container.find('img').height() / 100)),\n                leftPercent = Math.ceil((left + markerArea) / (self.$container.find('img').width() / 100));\n\n\n            self.handle_event('done', Math.min(leftPercent, 100), Math.min(topPercent, 100));\n        });\n\n        var offset = this.$container.offset();\n\n        if (!offset) {\n            throw 'cannot initialize image focus point';\n        }\n\n        $(document).on('mousemove.bt-focus-point', function (e, pageX, pageY) {\n\n            if (!self.isMouseDown) {\n                return;\n            }\n\n            pageX = pageX || e.pageX;\n            pageY = pageY || e.pageY;\n\n            var x = pageX - offset.left - markerArea,\n                y = pageY - offset.top - markerArea;\n\n\n            var $img = self.$container.find('img'),\n                box = {\n\n                    top: $img.height() - markerArea,\n                    left: $img.width() - markerArea,\n                };\n\n            y = Math.max(-markerArea, y);\n            y = Math.min(box.top, y);\n\n            x = Math.max(-markerArea, x);\n            x = Math.min(box.left, x);\n\n            $marker.css({\n                top: Math.floor(y),\n                left: Math.floor(x),\n            });\n        });\n    }\n};","var mediaModal = {\n\n    initialized: false,\n    $context: '',\n\n    setup: function () {\n\n        if (!wp || !wp.media) {\n            return;\n        }\n\n        var self = this;\n\n        if (wp.media.featuredImage && wp.media.featuredImage.frame) {\n\n            this.initFeaturedImageModal();\n        }\n\n        if (wp.media.frames && self.isUploadPage()) {\n\n            $(document).one('click', \".media-frame-content li.attachment\", function () {\n\n                setTimeout(function () {\n                    self.initMediaLibraryModal();\n\n                    self.initFocusPoint();\n                    self.appendPreviewButton($(\".attachment-actions .button\", self.$context));\n                });\n            });\n        }\n    },\n\n    initFeaturedImageModal: function () {\n\n        var self = this;\n\n        var frame = wp.media.featuredImage.frame();\n        frame.on('ready', function () {\n\n            if (self.initialized) {\n                return;\n            }\n\n            self.$context = this.models[0].frame.$el;\n            self.initialized = true;\n\n            wp.Uploader.queue.on('reset', function () { // Upload completed\n\n                setTimeout(function () {\n                    self.initFocusPoint();\n                    self.appendPreviewLink();\n                });\n            });\n        });\n\n        frame.on('selection:toggle', function () { // Image selected\n\n            self.initFocusPoint();\n            self.appendPreviewLink();\n        });\n\n        frame.on('uploader:ready', function (a) { // Image selected\n\n            var interval = setInterval(function () {\n\n                if (self.initFocusPoint()) {\n\n                    self.appendPreviewLink();\n\n                    clearInterval(interval);\n                }\n\n            }, 200);\n        });\n\n    },\n\n    initMediaLibraryModal: function () {\n\n        var self = this;\n\n        wp.media.frames.edit.on('refresh', function (e) {\n\n            self.initFocusPoint();\n            self.appendPreviewButton($(\".attachment-actions .button\", self.$context));\n        });\n    },\n\n    initFocusPoint: function () {\n\n        return focusPoint.setup({\n                $el: $(\".thumbnail-image img\", this.$context),\n                parentSelector: \".media-frame-content\",\n                grid: loc.get(\"grid\"),\n                defaultPosition: this.getFocusPoint()\n            },\n            {\n                done: $.proxy(this.saveFocusPoint, this)\n            }\n        );\n    },\n\n    appendPreviewLink: function () {\n\n        var self = this,\n            link = \"<div class='preview-thumbnails'><a href='#'>\" + loc.translate('preview') + \"</a></div>\";\n\n        var $link = $(link).insertAfter($(\".attachment-info .edit-attachment\", this.$context));\n\n        $link.on('click', function (e) {\n            e.preventDefault();\n\n            self.previewModal();\n        });\n    },\n\n    appendPreviewButton: function ($afterEl) {\n\n        var self = this,\n            link = \"<input type='button' class='button preview-images-btn' value='\" + loc.translate('preview') + \"'>\";\n\n        var $link = $(link).insertAfter($afterEl);\n\n        $link.on('click', function (e) {\n            e.preventDefault();\n\n            self.previewModal();\n        });\n    },\n\n    previewModal: function () {\n\n        var self = this;\n\n        self.loading('start');\n\n        var ajax = previewData.get(self.attachmentId(), self.securityNonce());\n\n        ajax.done(function (res) {\n\n            if (!helper.isUndefined(res.data))\n                previewModal.setup(res.data);\n        });\n\n        ajax.always(function () {\n\n            self.loading('stop');\n        });\n\n    },\n\n    saveFocusPoint: function (topPercent, leftPercent) {\n\n        this.regenerateThumbnails(topPercent, leftPercent);\n        this.setFocusPoint(topPercent / 100, leftPercent / 100);\n    },\n\n    regenerateThumbnails: function (topPercent, leftPercent) {\n\n        var self = this;\n\n        var attachment_id = self.attachmentId();\n\n        self.loading('start');\n\n        var ajax = wp.ajax.post('bt-regenerate-thumbnails', {\n            thumbnail_id: attachment_id,\n            nonce: self.securityNonce(),\n            focus_x: topPercent,\n            focus_y: leftPercent,\n        });\n\n        ajax.done(function (res) {\n\n            if (!helper.isUndefined(res.message)) {\n\n                var $msgParent = self.isUploadPage() ? $(\".thumbnail-image\", self.$context) : $(\".attachment-info\", self.$context);\n\n                helper.notify($msgParent, res.message);\n            }\n        });\n\n        ajax.always(function () {\n\n            self.loading('stop');\n        });\n    },\n\n    loading: function (state) {\n\n        switch (state) {\n\n            case 'start':\n\n                UI.block($(\".attachment-info\", this.$context));\n\n                break;\n\n            case 'stop':\n                UI.unblock($(\".attachment-info\", this.$context));\n\n                break;\n        }\n    },\n\n    attachmentId: function () {\n\n        if (this.isUploadPage()) {\n\n            return $(\".attachment-details\", this.$context).data('id');\n\n        } else {\n\n            return $(\".attachment.selected\", this.$context).data('id');\n        }\n    },\n\n\n    isUploadPage: function () {\n        return $(document.body).hasClass('upload-php');\n    },\n\n    securityNonce: function () {\n        return $(\".bt-regenerate-nonce\", this.$context).val();\n    },\n\n    getFocusPoint: function () {\n\n        var $attachment = $(\".attachment.selected\", this.$context),\n            point = $attachment.data('focus-point');\n\n        return point ? point.split('-') : this.getDefaultFocusPoint();\n\n    },\n    setFocusPoint: function (top, left) {\n\n        $(\".attachment.selected\", this.$context).data(\"focus-point\", top + \"-\" + left);\n    },\n    getDefaultFocusPoint: function () {\n\n        var point = $(\".bt-focus-point-xy\", this.$context).val(),\n            $img = $(\".thumbnail-image img\", this.$context);\n\n        return point && point.indexOf('-') > -1 ? point.split('-') : helper.defaultFocusPoint($img.width(), $img.height());\n    }\n};\n\nmediaModal.setup();\n","var mediaLibPage = {\n\n    initialized: false,\n    $context: '',\n\n    $img: '',\n\n    setup: function () {\n\n        if (!wp || !wp.media) {\n            return;\n        }\n\n        var $body = $(document.body);\n\n        this.$context = $body;\n\n        if (!$body.hasClass('post-type-attachment') || !$body.hasClass('post-php')) {\n            return\n        }\n\n        this.$img = $(\".wp_attachment_image img.thumbnail\", this.$context);\n\n        this.editAttachmentPage();\n    },\n\n    editAttachmentPage: function () {\n\n        this.initFocusPoint();\n\n        this.appendPreviewButton($(\".wp_attachment_image .button\", this.$context));\n    },\n\n    initFocusPoint: function () {\n\n        focusPoint.setup({\n                $el: this.$img,\n                parentSelector: \"#wpbody-content\",\n\n                grid: loc.get(\"grid\"),\n                defaultPosition: this.getFocusPoint()\n            }, {\n                done: $.proxy(this.saveFocusPoint, this)\n            }\n        );\n    },\n\n\n    appendPreviewButton: function ($afterEl) {\n\n        var self = this,\n            link = \"<input type='button' class='button preview-images-btn' value='\" + loc.translate('preview') + \"'>\";\n\n        var $link = $(link).insertAfter($afterEl);\n\n        $link.on('click', function (e) {\n            e.preventDefault();\n\n            self.previewModal();\n        });\n    },\n\n    previewModal: function () {\n\n        var self = this;\n\n        self.loading('start');\n\n        var ajax = previewData.get(self.attachmentId(), self.securityNonce());\n\n        ajax.done(function (res) {\n\n            if (!helper.isUndefined(res.data))\n                previewModal.setup(res.data);\n        });\n\n        ajax.always(function () {\n\n            self.loading('stop');\n        });\n\n    },\n\n    saveFocusPoint: function (topPercent, leftPercent) {\n\n        this.regenerateThumbnails(topPercent, leftPercent);\n        this.setFocusPoint(topPercent / 100, leftPercent / 100);\n    },\n\n    regenerateThumbnails: function (topPercent, leftPercent) {\n\n        var self = this;\n\n        var attachment_id = self.attachmentId();\n\n        self.loading('start');\n\n        var ajax = wp.ajax.post('bt-regenerate-thumbnails', {\n            thumbnail_id: attachment_id,\n            nonce: self.securityNonce(),\n            focus_x: topPercent,\n            focus_y: leftPercent,\n        });\n\n        ajax.done(function (res) {\n\n            if (!helper.isUndefined(res.message)) {\n\n                helper.notify($(\".wp_attachment_holder\", this.$context), res.message);\n            }\n        });\n\n        ajax.always(function () {\n\n            self.loading('stop');\n        });\n    },\n\n    loading: function (state) {\n\n        switch (state) {\n\n            case 'start':\n\n                UI.block($(\".wp_attachment_holder\", this.$context));\n\n                break;\n\n            case 'stop':\n                UI.unblock($(\".wp_attachment_holder\", this.$context));\n\n                break;\n        }\n    },\n\n    attachmentId: function () {\n\n        return $(\"#post_ID\", this.$context).val();\n    },\n\n\n    securityNonce: function () {\n\n        return $(\".bt-regenerate-nonce\", this.$context).val();\n    },\n\n    getFocusPoint: function () {\n\n        return this.getDefaultFocusPoint();\n    },\n\n    setFocusPoint: function (top, left) {\n\n        $(\".attachment.selected\", this.$context).data(\"focus-point\", top + \"-\" + left);\n    },\n\n    getDefaultFocusPoint: function () {\n\n        var point = $(\".bt-focus-point-xy\", this.$context).val();\n\n        return point && point.indexOf('-') > -1 ? point.split('-') : helper.defaultFocusPoint(this.$img.width(), this.$img.height());\n    }\n};\n\nmediaLibPage.setup();\n"]}