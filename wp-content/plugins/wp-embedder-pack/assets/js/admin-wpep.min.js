jQuery(document).ready(function(i){var n={isObject:function(e){p;var t=typeof e;return"function"===t||"object"===t&&!!e},isUndefined:function(e){return void 0===e},modalTemplate:function(e){var t=document.getElementById(e);if(!t)return"";if(!t.innerText)return"";var o=t.innerText,a=i.bs_modal_template("default");return a&&(o=a.replace("{{{bs_body}}}",o)),o},registerModalTemplate:function(e){var t=this.modalTemplate(e);return!!t&&(i.bs_modal_template(e,t),!0)},formatSize:function(e){if(this.isUndefined(e)||/\D/.test(e))return"N/A";function t(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)}var o=Math.pow(1024,4);return o<e?t(e/o,1)+" TB":e>(o/=1024)?t(e/o,1)+" GB":e>(o/=1024)?t(e/o,1)+" MB":1024<e?Math.round(e/1024)+" KB":e+" Byte"}},c={getItem:function(e){return e&&decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},setItem:function(e,t,o,a,n,i){if(!e||/^(?:expires|max\-age|path|domain|secure)$/i.test(e))return!1;var c="";if(o)switch(o.constructor){case Number:c=o===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+o;break;case String:c="; expires="+o;break;case Date:c="; expires="+o.toUTCString()}return document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+c+(n?"; domain="+n:"")+(a?"; path="+a:"")+(i?"; secure":""),!0},removeItem:function(e,t,o){return!!this.hasItem(e)&&(document.cookie=encodeURIComponent(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(o?"; domain="+o:"")+(t?"; path="+t:""),!0)},hasItem:function(e){return!!e&&new RegExp("(?:^|;\\s*)"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)},keys:function(){for(var e=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),t=e.length,o=0;o<t;o++)e[o]=decodeURIComponent(e[o]);return e}},l={templates:["modal-template","shortcode-template","custom-url-template"],bsModal:!1,initModal:function(){this.templates.forEach(function(e){n.registerModalTemplate("wp-embedder-pack-"+e)}),this.bsModal=i.bs_modal({modalId:"better-embed-modal",template:"wp-embedder-pack-modal-template",content:WP_Embedder_Pack_loc.main_modal,events:{after_append_html:function(){i(".wep-providers a",this.$modal).on("click",function(){var e=i(this);if(e.hasClass("disabled")){var t,o={},a=i.trim(e.text());for(t in WP_Embedder_Pack_loc.warning_modal)o[t]=WP_Embedder_Pack_loc.warning_modal[t].replace(/\{provider\}/g,a);i.bs_modal({modalId:"better-embed-warning",content:o,buttons:{close_modal:{label:WP_Embedder_Pack_loc.labels.go,type:"primary",clicked:function(){window.open(WP_Embedder_Pack_loc.ajax_url.replace("admin-ajax.php","admin.php?page=better-studio%2Fwp-embedder-pack"),"_blank")}},custom_event:{label:WP_Embedder_Pack_loc.labels.cancel,type:"secondary",action:"close"}}})}else{(a=e.data("provider"))&&m[a]&&m[a].call(m)}})}}})},open:function(){this.bsModal?this.bsModal.init():(this.initModal(),m.init())},close:function(){return this.bsModal.close_modal()}},r=!1,d=!1,s=c.getItem("wep-google-drive"),m={icons:{},init:function(){gapi.load("auth",{callback:function(){d=!0}}),gapi.load("picker",{callback:function(){r=!0}});var e=document.createElement("script");e.src="https://www.dropbox.com/static/api/2/dropins.js",e.dataset.appKey=WP_Embedder_Pack_loc.api.dropbox,e.id="dropboxjs",document.body.appendChild(e);var o=this.icons;i(".wep-providers a",l.bsModal.$modal).each(function(){var e=i(this),t=e.data("provider");t&&m[t]&&(o[t]=e.find(".fa,.icon")[0].outerHTML)})},upload:function(){var t=this,o=wp.media({title:WP_Embedder_Pack_loc.labels.media_title,button:{text:WP_Embedder_Pack_loc.labels.media_button},multiple:!1});o.on("select",function(){var e=o.state().get("selection").first().toJSON();u.editForm(e.url,{icon:t.icons.upload||!1,filename:e.filename,filesize:e.filesizeInBytes},{attachment_id:e.id})}),o.open()},custom_url:function(){var t=this;l.bsModal.change_skin({animations:{body:"bs-animate bs-fadeInLeft"},buttons:{close_modal:{label:WP_Embedder_Pack_loc.labels.insert,type:"primary",clicked:function(){var e=i.trim(i("#wep-custom-url",this.$modal).val());e.match(/^https?\:\/\//)||(e="http://"+e),u.editForm(e,{icon:t.icons.custom_url||!1,filename:filename=e.split("/").reverse()[0],filesize:void 0})}},custom_event:{label:WP_Embedder_Pack_loc.labels.cancel,type:"secondary",action:"close"}},template:"wp-embedder-pack-custom-url-template"})},dropbox:function(){var o=this;Dropbox.init({appKey:WP_Embedder_Pack_loc.dropbox_key}),Dropbox.choose({linkType:"preview",multiselect:!1,success:function(e){var t=e[0].link.replace("dl=0","dl=1");u.editForm(t,{icon:o.icons.dropbox||!1,filename:e[0].name,filesize:e[0].bytes})}})},google:function(){var o=this;!function(o){var a;function n(e,t){d&&r&&(d&&s&&t?(new google.picker.PickerBuilder).addView(e).setOAuthToken(s).setDeveloperKey(WP_Embedder_Pack_loc.api.google.api_key).setCallback(o).build():(new google.picker.PickerBuilder).addView(e).setDeveloperKey(WP_Embedder_Pack_loc.api.google.api_key).setCallback(o).build()).setVisible(!0)}var e=google.picker.ViewId.DOCS;d&&!s?(a=e,window.gapi.auth.authorize({client_id:WP_Embedder_Pack_loc.api.google.client_id,scope:["https://www.googleapis.com/auth/drive"],immediate:!1},function(e){var t=parseInt(e.expires_at);e&&!e.error&&(s=e.access_token,n(a,!0),c.setItem("wep-google-drive",s,t-Math.ceil(Date.now()/1e3)))})):n(e,!0)}(function(e){if(e[google.picker.Response.ACTION]==google.picker.Action.PICKED){var t=e[google.picker.Response.DOCUMENTS][0];u.editForm(t.embedUrl,{icon:o.icons.google||!1,filesize:t.sizeBytes,download_able:!1,filename:t.name},{drive_id:t.id})}})}},u={insertContent:function(e){tinyMCE.activeEditor.insertContent(e)},insertShortcode:function(e){this.insertContent(wp.shortcode.string(e))},generateAtts:function(){if(!l.bsModal)throw"invalid call";var n={};return i(":input",l.bsModal.$modal).each(function(){var e=i(this),a=encodeURIComponent(e.attr("name"));e.is(":radio,:checkbox")?n[a]=this.checked?this.value:"0":e.is("select[multiple]")?(n[a]=[],e.find("option:selected").each(function(e){var t=i(this),o=encodeURIComponent(t.val());n[a][o]=o})):n[a]=this.value}),n},editForm:function(e,t,o){if(!l.bsModal)throw"invalid call";t=i.extend({icon:'<i class="fa fa-upload"></i>',url:e,download_able:!0},t||{});var a=this;t.filesize&&(t.filesize=n.formatSize(t.filesize)),l.bsModal.change_skin({animations:{body:"bs-animate bs-fadeInLeft"},content:t,buttons:{close_modal:{label:WP_Embedder_Pack_loc.labels.insert,type:"primary",clicked:function(){var e=i.extend(a.generateAtts(),o||{});e.attachment_id&&delete e.url,u.insertShortcode({tag:"wp-embedder-pack",content:"",attrs:e,type:"self-closing"}),this.close_modal()}},custom_event:{label:WP_Embedder_Pack_loc.labels.cancel,type:"secondary",action:"close"}},template:"wp-embedder-pack-shortcode-template"})}};i(".wp-embedder-pack").click(function(){l.open()})});