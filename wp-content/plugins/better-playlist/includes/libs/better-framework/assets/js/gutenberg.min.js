!function(){var e={},t={className:{removeAll:function(e,t){var i=this.remove;return t.forEach(function(t){e=i(e,t)}),e},remove:function(e,t){return e?e.replace(new RegExp("\\b"+t+"\\b","g"),"").trim():""},add:function(e,t){var i=e.split(" ");return i.push(t),_.unique(i).join(" ")}}};function i(e){this.element=window.wp&&window.wp.element,this.blocks=window.wp&&window.wp.blocks,this.prefix="better-studio/",this.props={},this.attributes={},this.blockFields={},this.shortcode={},this.liveTemplate={},this.liveTemplateAttributes={},this.props=e,this.attributes=e&&e.attributes||{}}i.prototype.registerBlockType=function(e,t,i,r){this.shortcode=e,this.blockFields=t,this.liveTemplate=i,this.liveTemplateAttributes=r;var s=this.shortcode.block_id||this.shortcode.id.replace(/_/g,"-"),n=this.shortcode.category||"betterstudio";this.bfGutenbergCatExists(n)&&this.blocks.registerBlockType(this.prefix+s,{title:this.shortcode.name||this.shortcode.id,icon:this.blockIcon(),category:n,edit:this.editBlock.bind(this),save:this.saveBlock.bind(this),attributes:this.blockAttributes(this.shortcode.id)})},i.prototype.saveBlock=function(e){return null},i.prototype.bfGutenbergCatExists=function(t){if(void 0===e[t]){e[t]=!1;for(var i=this.blocks.getCategories()||[],r=0;r<i.length;r++)if(i[r].slug===t){e[t]=!0;break}}return e[t]},i.prototype.blockAttributes=function(e){if(!this.blockFields)return[];var t={},i=function(e){e.id&&e.attribute&&(t[e.id]=e.attribute),e.children&&e.children.forEach(function(e){i(e)})};return this.blockFields.forEach(i),this.liveTemplateAttributes&&(t=Object.assign(t,this.liveTemplateAttributes)),t},i.prototype.editBlock=function(e){var t=e.name.replace(this.prefix,"");if(!t||t===e.name)return[];!e.isSelected&&this.props.name||(this.props=e);var i=[this.buildBlockFields()];if(!this.liveTemplate){var r=!this.shortcode.click_able,s=this.element.createElement(this.getComponent("ServerSideRender"),{block:e.name,attributes:e.attributes,key:"D2"});r&&(s=this.element.createElement(this.getComponent("Disabled"),{key:"D1"},s)),i.push(s)}return i},i.prototype.buildElement=function(e,t){var i=[],r=this;return e.forEach(function(e){e.children?i.push(r.buildElement(e.children,e)):Array.isArray(e)?i.push(r.buildElement(e,t)):i.push(r.createElement(e))}),r.createElement(t,i)},i.prototype.createElement=function(e,t){var i=[];t&&t.length?i=t:e.args&&e.args.innerText&&(i=e.args.innerText);var r=[this.getComponent(e.component),this.componentArgs(e)].concat(i);return this.element.createElement.apply(this.element,r)},i.prototype.componentArgs=function(e){var i=e.args||{};if("Fragment"===e.component||e.component.match(/tag_(.+)/))return i;var r=this,s="add_class"===e.action;i.onChange=i.onChange||function(i){var n,o;if(s){var l=r.props.attributes.className;if(e.attribute&&e.attribute.enum)o=t.className.removeAll(l,e.attribute.enum),o=t.className.add(o,i);else if(0===i||1===i){var a=e.id;o=t.className[1===i?"add":"remove"](l,a)}n="className"}else n=e.id,o=i;return r.props.attributes[n]=o,r.props.setAttributes({[n]:o}),!1};var n="";return s?e.attribute&&this.props.attributes.className&&(n=_.intersection(e.attribute.enum||[e.id],this.props.attributes.className.split(" ")).shift()):n=this.props.attributes[e.id],i.value=n||e.std,i},i.prototype.buildBlockFields=function(){var e=[{id:"inspector",component:"InspectorControls",args:{key:"inspector"},children:[{id:"bf_edit_panel",component:"BF_Edit_Panel",args:{type:"edit-panel"},key:"bf_edit_panel",children:this.blockFields}]}];return this.liveTemplate&&e.push(this.liveTemplate),this.buildElement(e,{id:"block_fragment",component:"Fragment",args:{key:"block_fragment"}})},i.prototype.getComponent=function(e){var t=e.match(/tag_(.+)/);return t?t[1]:wp.editor[e]?wp.editor[e]:wp.components[e]?wp.components[e]:wp.element[e]?wp.element[e]:void 0},i.prototype.blockIcon=function(){return this.shortcode.icon_url?this.element.createElement("img",{src:this.shortcode.icon_url}):this.shortcode.icon||""},{init:function(){wp.hooks&&wp.hooks.addFilter&&wp.compose&&wp.compose.createHigherOrderComponent&&BF_Gutenberg.stickyFields&&(this.registerBlocks(),this.registerSharedFields(),this.registerSharedAttributes())},registerBlocks:function(){if(BF_Gutenberg&&BF_Gutenberg.blocks)for(var e in BF_Gutenberg.blocks)(new i).registerBlockType(BF_Gutenberg.blocks[e],BF_Gutenberg.blockFields[e],BF_Gutenberg.liveEdit[e]&&BF_Gutenberg.liveEdit[e].template,BF_Gutenberg.liveEdit[e]&&BF_Gutenberg.liveEdit[e].attributes)},extraAttributes(e){var t=BF_Gutenberg.extraAttributes,i={};for(var r in t)if(t.hasOwnProperty(r)){var s=t[r];(s.for_blocks||[]).indexOf(e)>-1&&(i[r]=s)}return i},registerSharedAttributes:function(){var e=this;wp.hooks.addFilter("blocks.registerBlockType","betterstudio/shared_settings",function(t,i){var r=e.extraAttributes(i);return _.isEmpty(r)||(t.attributes=_.extend(t.attributes,r)),t})},registerSharedFields:function(){wp.hooks.addFilter("editor.BlockEdit","betterstudio/shared_settings",wp.compose.createHigherOrderComponent(function(e){return function(t){var r=new i(t),s=BF_Gutenberg.stickyFields.filter(function(e){return!(e.exclude_blocks&&e.exclude_blocks.indexOf(t.name)>-1)&&(!e.include_blocks||e.include_blocks.indexOf(t.name)>-1)});if(!s)return r.element.createElement(e,t);var n=r.buildElement(s,{id:"inspector",component:"InspectorControls",args:{key:"inspector"}});return r.element.createElement(r.getComponent("Fragment"),{key:"E1"},n,r.element.createElement(e,t))}}))}}.init()}();