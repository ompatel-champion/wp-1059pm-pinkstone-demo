jQuery(document).ready(function(t){var e={isObject:function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},isUndefined:function(t){return void 0===t},notify:function(e,n){e.append("<div class='bt-user-message success' style='display: none;'>"+n+"</div>"),t(".bt-user-message",e).fadeIn().delay(5e3).queue(function(e){t(this).fadeOut(function(){t(this).remove()}),e()})},defaultFocusPoint:function(t,e){return o.get("portrait_default_top")&&this.isImagePortrait(t,e)?[.5,0]:o.get("default_fp")},isImagePortrait:function(t,e){return t+.14*e<e}},n={storage:{},add:function(t,i,o){e.isUndefined(n[o])&&(n[o]={}),n[o][t]=i},get:function(t,e){if(this.exist(t,e))return n[e][t]},exist:function(t,i){return!e.isUndefined(n[i])&&!e.isUndefined(n[i][t])}},i={is_blocked:function(t){return!!t.data("bc-el-blocked")},block:function(e){this.is_blocked(e)||(e.data("bc-el-blocked",!0),e.prepend('<div class="bc-block-overlay" style="z-index:10;display:none;border:none;margin:0;padding:0;width:100%;height:100%;top:0;left:0;display:none;position: absolute;background:rgba(255,255,255,0.4)"></div>'),t(".bc-block-overlay").fadeIn())},unblock:function(e){this.is_blocked(e)&&(e.data("bc-el-blocked",!1),t(".bc-block-overlay").fadeOut(function(){t(this).remove()}))}},o={get:function(t){if(t){if(t.indexOf(".")==-1)return st_loc[t];var e=t.split("."),n=st_loc[e[0]];e=e.splice(1);for(var i=e.length-1,o=0;o<=i;o++){if("object"!=typeof n[e[o]]&&o!==i)return;n=n[e[o]]}return n}},translate:function(t){return this.get("translate."+t)}},a={get:function(e,i){return t.Deferred(function(t){if(n.exist(e,"selector-data"))return void t.resolveWith(this,[n.get(e,"selector-data")]);var o=wp.ajax.post("bt-preview-thumbnails",{thumbnail_id:e,nonce:i});o.done(function(i){n.add(e,i,"selector-data"),t.resolveWith(this,[i])}),o.fail(function(){t.rejectWith(this)})}).promise()}},s={info:{},setup:function(t){this.info=t,this.open()},open:function(){var e=this;e.info.images&&t.bs_selector_modal({bsModal:{destroyHtml:!0,show:!0},noSidebar:!0,id:"bt-thumbnil-selector",modalClass:"bt-modal",itemInnerHtml:'<div class="bf-item-container">\n    <figure>\n        <img src="{{img}}"\n             alt="{{label}}"\n             class="bs-style-thumbnail" data-current-image="{{current_img}}">\n    </figure>\n</div>',content:e.info.l10n,items:e.info.images.map(e.noCacheImage),itemsGroupSize:9,events:{}},{initialZIndex:209901})},noCacheImage:function(t){return t.img+="?"+(new Date).getTime(),t}},c={markerArea:10,isMouseDown:!1,$element:!1,$container:!1,options:{},events:{},setup:function(t,e){return this.events=e||{},this.options=t||{},!!this.prepare()&&(this.bindEvents(),!0)},prepare:function(){return!(!this.options.$el||!this.options.$el.length)&&(this.$element=this.options.$el,this.$element.wrap("<div class='bt-focus-point'></div>"),this.$container=this.$element.parent(),this.$container.append('<div class="bt-focus-point-marker"></div>'),this.options.defaultPosition&&this.fixMarkerPosition(this.options.defaultPosition),this.options.grid&&this.appendGrid(),!0)},handle_event:function(t){var e=Array.prototype.slice.call(arguments,1);if("function"==typeof this.events[t])return this.events[t].apply(this,e)},appendGrid:function(){var e=t("<div>",{"class":"grid"}).insertAfter(this.$container.find("img"));e.html('<div class="x1"></div>\n<div class="x2"></div>\n\n<div class="y1"></div>\n<div class="y2"></div>')},fixMarkerPosition:function(e){var n=parseFloat(e[0]),i=parseFloat(e[1]);if(n>=0&&n<=1&&i>=0&&i<=1){var o=this.$container.find("img"),a=this.markerArea;t(".bt-focus-point-marker",this.$container).css({top:Math.floor(o.height()*i)-a,left:Math.floor(o.width()*n)-a})}},bindEvents:function(){var e=this,n=this.markerArea,i=t(".bt-focus-point-marker",this.$container),o=function(){var n=e.options.parentSelector?t(".bt-focus-point-marker",this.$container).closest(e.options.parentSelector):"";return n&&n.length?n:t(".bt-focus-point-marker",this.$container)}();i.mousedown(function(){e.isMouseDown=!0}),t(".bt-focus-point").mousedown(function(n){e.isMouseDown=!0,t(document).trigger("mousemove.bt-focus-point",[n.pageX,n.pageY])}),o.mouseup(function(){if(e.isMouseDown){e.isMouseDown=!1;var t=parseInt(i.css("top").replace("px","")),o=parseInt(i.css("left").replace("px","")),a=Math.ceil((t+n)/(e.$container.find("img").height()/100)),s=Math.ceil((o+n)/(e.$container.find("img").width()/100));e.handle_event("done",Math.min(s,100),Math.min(a,100))}});var a=this.$container.offset();if(!a)throw"cannot initialize image focus point";t(document).on("mousemove.bt-focus-point",function(t,o,s){if(e.isMouseDown){o=o||t.pageX,s=s||t.pageY;var c=o-a.left-n,r=s-a.top-n,u=e.$container.find("img"),d={top:u.height()-n,left:u.width()-n};r=Math.max(-n,r),r=Math.min(d.top,r),c=Math.max(-n,c),c=Math.min(d.left,c),i.css({top:Math.floor(r),left:Math.floor(c)})}})}},r={initialized:!1,$context:"",setup:function(){if(wp&&wp.media){var e=this;wp.media.featuredImage&&wp.media.featuredImage.frame&&this.initFeaturedImageModal(),wp.media.frames&&e.isUploadPage()&&t(document).one("click",".media-frame-content li.attachment",function(){setTimeout(function(){e.initMediaLibraryModal(),e.initFocusPoint(),e.appendPreviewButton(t(".attachment-actions .button",e.$context))})})}},initFeaturedImageModal:function(){var t=this,e=wp.media.featuredImage.frame();e.on("ready",function(){t.initialized||(t.$context=this.models[0].frame.$el,t.initialized=!0,wp.Uploader.queue.on("reset",function(){setTimeout(function(){t.initFocusPoint(),t.appendPreviewLink()})}))}),e.on("selection:toggle",function(){t.initFocusPoint(),t.appendPreviewLink()}),e.on("uploader:ready",function(e){var n=setInterval(function(){t.initFocusPoint()&&(t.appendPreviewLink(),clearInterval(n))},200)})},initMediaLibraryModal:function(){var e=this;wp.media.frames.edit.on("refresh",function(n){e.initFocusPoint(),e.appendPreviewButton(t(".attachment-actions .button",e.$context))})},initFocusPoint:function(){return c.setup({$el:t(".thumbnail-image img",this.$context),parentSelector:".media-frame-content",grid:o.get("grid"),defaultPosition:this.getFocusPoint()},{done:t.proxy(this.saveFocusPoint,this)})},appendPreviewLink:function(){var e=this,n="<div class='preview-thumbnails'><a href='#'>"+o.translate("preview")+"</a></div>",i=t(n).insertAfter(t(".attachment-info .edit-attachment",this.$context));i.on("click",function(t){t.preventDefault(),e.previewModal()})},appendPreviewButton:function(e){var n=this,i="<input type='button' class='button preview-images-btn' value='"+o.translate("preview")+"'>",a=t(i).insertAfter(e);a.on("click",function(t){t.preventDefault(),n.previewModal()})},previewModal:function(){var t=this;t.loading("start");var n=a.get(t.attachmentId(),t.securityNonce());n.done(function(t){e.isUndefined(t.data)||s.setup(t.data)}),n.always(function(){t.loading("stop")})},saveFocusPoint:function(t,e){this.regenerateThumbnails(t,e),this.setFocusPoint(t/100,e/100)},regenerateThumbnails:function(n,i){var o=this,a=o.attachmentId();o.loading("start");var s=wp.ajax.post("bt-regenerate-thumbnails",{thumbnail_id:a,nonce:o.securityNonce(),focus_x:n,focus_y:i});s.done(function(n){if(!e.isUndefined(n.message)){var i=o.isUploadPage()?t(".thumbnail-image",o.$context):t(".attachment-info",o.$context);e.notify(i,n.message)}}),s.always(function(){o.loading("stop")})},loading:function(e){switch(e){case"start":i.block(t(".attachment-info",this.$context));break;case"stop":i.unblock(t(".attachment-info",this.$context))}},attachmentId:function(){return this.isUploadPage()?t(".attachment-details",this.$context).data("id"):t(".attachment.selected",this.$context).data("id")},isUploadPage:function(){return t(document.body).hasClass("upload-php")},securityNonce:function(){return t(".bt-regenerate-nonce",this.$context).val()},getFocusPoint:function(){var e=t(".attachment.selected",this.$context),n=e.data("focus-point");return n?n.split("-"):this.getDefaultFocusPoint()},setFocusPoint:function(e,n){t(".attachment.selected",this.$context).data("focus-point",e+"-"+n)},getDefaultFocusPoint:function(){var n=t(".bt-focus-point-xy",this.$context).val(),i=t(".thumbnail-image img",this.$context);return n&&n.indexOf("-")>-1?n.split("-"):e.defaultFocusPoint(i.width(),i.height())}};r.setup();var u={initialized:!1,$context:"",$img:"",setup:function(){if(wp&&wp.media){var e=t(document.body);this.$context=e,e.hasClass("post-type-attachment")&&e.hasClass("post-php")&&(this.$img=t(".wp_attachment_image img.thumbnail",this.$context),this.editAttachmentPage())}},editAttachmentPage:function(){this.initFocusPoint(),this.appendPreviewButton(t(".wp_attachment_image .button",this.$context))},initFocusPoint:function(){c.setup({$el:this.$img,parentSelector:"#wpbody-content",grid:o.get("grid"),defaultPosition:this.getFocusPoint()},{done:t.proxy(this.saveFocusPoint,this)})},appendPreviewButton:function(e){var n=this,i="<input type='button' class='button preview-images-btn' value='"+o.translate("preview")+"'>",a=t(i).insertAfter(e);a.on("click",function(t){t.preventDefault(),n.previewModal()})},previewModal:function(){var t=this;t.loading("start");var n=a.get(t.attachmentId(),t.securityNonce());n.done(function(t){e.isUndefined(t.data)||s.setup(t.data)}),n.always(function(){t.loading("stop")})},saveFocusPoint:function(t,e){this.regenerateThumbnails(t,e),this.setFocusPoint(t/100,e/100)},regenerateThumbnails:function(n,i){var o=this,a=o.attachmentId();o.loading("start");var s=wp.ajax.post("bt-regenerate-thumbnails",{thumbnail_id:a,nonce:o.securityNonce(),focus_x:n,focus_y:i});s.done(function(n){e.isUndefined(n.message)||e.notify(t(".wp_attachment_holder",this.$context),n.message)}),s.always(function(){o.loading("stop")})},loading:function(e){switch(e){case"start":i.block(t(".wp_attachment_holder",this.$context));break;case"stop":i.unblock(t(".wp_attachment_holder",this.$context))}},attachmentId:function(){return t("#post_ID",this.$context).val()},securityNonce:function(){return t(".bt-regenerate-nonce",this.$context).val()},getFocusPoint:function(){return this.getDefaultFocusPoint()},setFocusPoint:function(e,n){t(".attachment.selected",this.$context).data("focus-point",e+"-"+n)},getDefaultFocusPoint:function(){var n=t(".bt-focus-point-xy",this.$context).val();return n&&n.indexOf("-")>-1?n.split("-"):e.defaultFocusPoint(this.$img.width(),this.$img.height())}};u.setup()});
//# sourceMappingURL=better-smart-thumbnails.min.js.map
